<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì•„ì´ë””ì–´ ì…ë ¥ í¼</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #fff;
      max-width: 1000px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .guide {
      font-size: 0.95rem;
      background-color: #f9f9f9;
      border-left: 4px solid #888;
      padding: 1rem;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    .idea-item {
      margin-bottom: 1.5rem;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .idea-item strong {
      font-size: 1.3rem;
    }
    .idea-item label {
      font-weight: bold;
      display: block;
      margin-top: 0.8rem;
    }
    .idea-item input[type="text"], .idea-item textarea {
      width: 100%;
      padding: 0.5rem;
      box-sizing: border-box;
      margin-top: 0.3rem;
    }
    .role-buttons button,
    .satisfaction-buttons button,
    .gpt-help-buttons button,
    .platform-tag-buttons button {
      margin-right: 1rem;
      margin-top: 0.3rem;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #eee;
      color: #333;
    }
    .role-buttons button.selected[data-role="0"] {
      background-color: #e74c3c;
      color: white;
    }
    .role-buttons button.selected[data-role="1"] {
      background-color: #3498db;
      color: white;
    }
    .satisfaction-buttons button.selected,
    .gpt-help-buttons button.selected,
    .platform-tag-buttons button.selected {
      background-color: #2ecc71;
      color: white;
    }
    .add-button {
      display: block;
      margin: 1rem auto;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      background-color: #333;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ë””ìì¸ ì•„ì´ë””ì–´ ê¸°ë¡ ì‹œìŠ¤í…œ</h1>
  <div class="guide">
    <p><strong>ì‹¤í—˜ ëª©ì :</strong> ì´ í¼ì€ ì—¬ëŸ¬ë¶„ì´ ë””ìì¸ ê³¼ì •ì—ì„œ ë§Œë“  ì•„ì´ë””ì–´ë¥¼ ê¸°ë¡í•˜ê³ , ê·¸ ì•„ì´ë””ì–´ê°€ ì–´ë–»ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•œ ì‹¤í—˜ì…ë‹ˆë‹¤.</p>
    <ul>
        <li>1. ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥¸ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.</li>
        <li>2. ê·¸ ì•„ì´ë””ì–´ê°€ <strong>'ì§ì ‘ ìƒê°í•œ ê²ƒ'</strong>ì¸ì§€ <strong>'AIë¥¼ í™œìš©í•œ ê²ƒ'</strong>ì¸ì§€ ì„ íƒí•˜ì„¸ìš”.</li>
        <li>3. AI ì´ë¯¸ì§€ ìƒì„±ê¸°ë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´ ì–´ë–¤ í”Œë«í¼ì„ ì‚¬ìš©í–ˆëŠ”ì§€ ì„ íƒí•˜ê³ , í”„ë¡¬í”„íŠ¸ì™€ ìƒì„±ëœ ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.</li>
        <li>4. í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ë‹¤ë¥¸ AIì˜ ë„ì›€(GPT ë“±)ì„ ë°›ì•˜ëŠ”ì§€ë„ í‘œì‹œí•´ì£¼ì„¸ìš”.</li>
        <li>5. ëª¨ë“  í•­ëª©ì„ ì„±ì‹¤íˆ ì‘ì„±í•´ì•¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </div>

  <div id="idea-list"></div>
  <button class="add-button" id="add-button">ì…ë ¥ ì¶”ê°€</button>
  <button class="add-button" id="save-json">JSON ì €ì¥</button>

  <script>
    function previewImage(event, idx) {
      const input = event.target;
      const preview = document.getElementById(`thumbnail-${idx}`);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    function addIdeaItem() {
      const list = document.getElementById('idea-list');
      const idx = list.children.length + 1;
      const container = document.createElement('div');
      container.className = 'idea-item';
      container.innerHTML = `
        <strong>${idx}. ì•„ì´ë””ì–´</strong>

        <label>ì•„ì´ë””ì–´ ìœ í˜• ì„ íƒ:</label>
        <div class="role-buttons">
          <button type="button" data-role="0">ì‚¬ëŒ</button>
          <button type="button" data-role="1">AI</button>
        </div>

        <div class="human-input">
          <label>ì•„ì´ë””ì–´ ë‚´ìš©:</label>
          <textarea name="idea-${idx}" rows="3"></textarea>
        </div>

        <div class="ai-options" style="display:none;">
          <label>ì‚¬ìš©í•œ ì´ë¯¸ì§€ ìƒì„± í”Œë«í¼ íƒœê·¸:</label>
          <div class="platform-tag-buttons">
            <button type="button" data-platform="GPT">GPT</button>
            <button type="button" data-platform="Midjourney">Midjourney</button>
            <button type="button" data-platform="Stable Diffusion">Stable Diffusion</button>
            <button type="button" data-platform="Prome AI">Prome AI</button>
            <button type="button" data-platform="Other">ê¸°íƒ€</button>
          </div>
          <input type="text" name="platform-other-${idx}" placeholder="ê¸°íƒ€ í”Œë«í¼ ì´ë¦„ ì…ë ¥" style="display:none; margin-top: 0.5rem;" />
          <input type="hidden" name="platform-${idx}" value="">

          <label>ì…ë ¥í•œ í”„ë¡¬í”„íŠ¸:</label>
          <textarea name="prompt-${idx}" rows="2"></textarea>

          <label>í•´ë‹¹ í”„ë¡¬í”„íŠ¸ê°€ AIì˜ ë„ì›€ì„ ë°›ì•˜ë‚˜ìš”?</label>
          <div class="gpt-help-buttons">
            <button type="button" data-gpt="yes">ì˜ˆ</button>
            <button type="button" data-gpt="no">ì•„ë‹ˆì˜¤</button>
          </div>
          <input type="hidden" name="gpt-help-${idx}" value="">

          <label>ìƒì„±ëœ ì´ë¯¸ì§€ ì„¤ëª…:</label>
          <textarea name="image-description-${idx}" rows="2"></textarea>

          <label>í”„ë¡¬í”„íŠ¸ ë§Œì¡±ë„:</label>
          <div class="satisfaction-buttons">
            <button type="button" data-satisfaction="5">ğŸ˜ ë§¤ìš° ë§Œì¡±</button>
            <button type="button" data-satisfaction="4">ğŸ˜Š ë§Œì¡±</button>
            <button type="button" data-satisfaction="3">ğŸ˜ ë³´í†µ</button>
            <button type="button" data-satisfaction="2">â˜¹ï¸ ë¶ˆë§Œì¡±</button>
            <button type="button" data-satisfaction="1">ğŸ˜  ë§¤ìš° ë¶ˆë§Œì¡±</button>
          </div>
          <input type="hidden" name="satisfaction-${idx}" value="">
        </div>

        <label>ê´€ë ¨ ì´ë¯¸ì§€:
          <input type="file" name="image-${idx}" accept="image/*" onchange="previewImage(event, ${idx})">
        </label>
        <div style="margin-top: 0.5rem;">
          <img id="thumbnail-${idx}" src="" style="max-width: 200px; display: none; border: 1px solid #ccc; border-radius: 4px;" />
        </div>

        <input type="hidden" name="role-${idx}" value="">
      `;

      list.appendChild(container);

      // ì´ë²¤íŠ¸ ë°”ì¸ë”©
      const btns = container.querySelectorAll('.role-buttons button');
      const roleInput = container.querySelector(`input[name="role-${idx}"]`);
      const aiOpts = container.querySelector('.ai-options');
      const humanInput = container.querySelector('.human-input');

      btns.forEach(b => {
        b.addEventListener('click', () => {
          btns.forEach(x => x.classList.remove('selected'));
          b.classList.add('selected');
          const role = b.getAttribute('data-role');
          roleInput.value = role;
          aiOpts.style.display = role === '1' ? 'block' : 'none';
          humanInput.style.display = role === '0' ? 'block' : 'none';
        });
      });

      container.querySelectorAll('.gpt-help-buttons button').forEach(btn => {
        btn.addEventListener('click', () => {
          container.querySelectorAll('.gpt-help-buttons button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          container.querySelector(`input[name="gpt-help-${idx}"]`).value = btn.getAttribute('data-gpt');
        });
      });

      container.querySelectorAll('.satisfaction-buttons button').forEach(btn => {
        btn.addEventListener('click', () => {
          container.querySelectorAll('.satisfaction-buttons button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          container.querySelector(`input[name="satisfaction-${idx}"]`).value = btn.getAttribute('data-satisfaction');
        });
      });

      const platformBtns = container.querySelectorAll('.platform-tag-buttons button');
      const platformInput = container.querySelector(`input[name="platform-${idx}"]`);
      const platformOtherInput = container.querySelector(`input[name="platform-other-${idx}"]`);
      platformBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          platformBtns.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          const platform = btn.getAttribute('data-platform');
          platformInput.value = platform;
          platformOtherInput.style.display = platform === 'Other' ? 'block' : 'none';
        });
      });
    }

    for (let i = 0; i < 6; i++) addIdeaItem();
    document.getElementById('add-button').onclick = addIdeaItem;

    document.getElementById('save-json').onclick = () => {
      const items = document.querySelectorAll('.idea-item');
      const episode = [];
      let valid = true;
      let pendingImages = 0;

      items.forEach((it, i) => {
        const idx = i + 1;
        const actor = it.querySelector(`input[name="role-${idx}"]`).value;
        if (!actor) valid = false;

        if (actor === '0') {
          const text = it.querySelector(`textarea[name="idea-${idx}"]`).value.trim();
          if (!text) valid = false;
          episode.push({ actor: 0, text });
        } else if (actor === '1') {
          let platform = it.querySelector(`input[name="platform-${idx}"]`).value;
          const platformOther = it.querySelector(`input[name="platform-other-${idx}"]`).value.trim();
          if (platform === 'Other') platform = platformOther;
          const prompt = it.querySelector(`textarea[name="prompt-${idx}"]`).value.trim();
          const gptHelp = it.querySelector(`input[name="gpt-help-${idx}"]`).value;
          const imageDesc = it.querySelector(`textarea[name="image-description-${idx}"]`).value.trim();
          const satisfaction = it.querySelector(`input[name="satisfaction-${idx}"]`).value;

          if (!platform || !prompt || !gptHelp || !satisfaction) valid = false;
          episode.push({ actor: 1, type: 'prompt', platform, gpt_help: gptHelp, satisfaction, text: prompt });
          if (imageDesc) episode.push({ actor: 1, type: 'image_description', text: imageDesc });

          const imageInput = it.querySelector(`input[name="image-${idx}"]`);
          if (imageInput && imageInput.files.length > 0) {
            pendingImages++;
            const reader = new FileReader();
            reader.onload = function(e) {
              episode.push({
                actor: 1,
                type: 'image_file',
                imageData: e.target.result
              });
              pendingImages--;
              if (pendingImages === 0) saveJsonFile(episode, valid);
            };
            reader.readAsDataURL(imageInput.files[0]);
          }
        }
      });

      if (!valid) {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ê³  íƒœê¹…ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (pendingImages === 0) saveJsonFile(episode, valid);
    };

    function saveJsonFile(episode, valid) {
      if (!valid) return;
      const data = { student01: episode };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'student01.json';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
